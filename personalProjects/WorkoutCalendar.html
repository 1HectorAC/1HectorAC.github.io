<!DOCTYPE html>
<html lang="en">

<head>
    <meta cahrset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../css/default.css">
    <title>HAC Portfolio - Workout Calendar Blog</title>
</head>

<body>
    <div class="title text-center">
        <h1><a href="../index.html">Programming Portfolio</a></h1>
        <h6><i>By Hector Acosta-Cervantes</i></h6>
    </div>
    <nav class="navbar navbar-expand-sm sticky-top navBarColor">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation"
                style="background-color:white">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../projects.html">Projects</a>
                    </li>
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../about.html">About</a>
                    </li>
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../contact.html">Contact</a>
                    </li>
                </ul>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                    <li><a class="dropdown-item customNavItem" href="../index.html">Home</a></li>
                    <li><a class="dropdown-item customNavItem" href="../projects.html">Projects</a></li>
                    <li><a class="dropdown-item customNavItem" href="../about.html">About</a></li>
                    <li><a class="dropdown-item customNavItem" href="../contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="blackBar"><a href="../projects.html">Projects</a> / Web Development / Workout Calendar Blog</div>
    <div class="container text-center">
        <div class="whitePanel">
            <h2>Workout Calendar Blog</h2>
            <h4><i>MERN</i></h4>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="blackPanel">
                    <h4>Summary</h4>
                    <hr class="whiteLine" />
                    <p class="paragraphText">
                        Manage your workout routine with this workout calendar website. Logged in uses can view, add,
                        and delete workouts to their plan. Link to the GitHub repo here.
                    </p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="blackPanel">
                    <h4>Goal</h4>
                    <hr class="whiteLine" />
                    <p class="paragraphText">To get more familiar with the MERN stack and how to authenticate logged in
                        users using Json Web Tokens.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="blackPanel">
                    <h4>Tools</h4>
                    <hr class="paragraphText" />
                    <p class="paragraphText">
                        MERN related tools such as MongoDB, Express.js, React, and Node. JavaScript is the main language
                        used.
                    </p>
                </div>
            </div>
            <div class="col-md-6 offset-md-3">
                <div class="blackPanel">
                    <h4>Table of Contents</h4>
                    <hr class="whiteLine" />
                    <ol>
                        <li><a href="#section1">Introduction</a></li>
                        <li><a href="#section2">MERN File Overview</a></li>
                        <ul>
                            <li><a href="#section2a">Backend</a></li>
                            <li><a href="#section2b">Frontend</a></li>
                        </ul>
                        <li><a href="#section3">Authentication</a></li>

                        <li><a href="#section4">Final Thoughts</a></li>
                        <li><a href="#section5">Resources</a></li>
                    </ol>
                </div>
            </div>
        </div>

        <div class="blackPanelWithMorePadding">
            <h4 id="section1">1. Introduction</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                For the sake of keeping this short I will gloss over basic node, express, and react setups. The main
                goal involves what I learned about the MERN stack so I will be talking about the larger picture of how
                parts connect and how authentication was done.
                The structure of a MERN stack is based on having a backend and frontend project that will connect to
                each other using API fetch requests. The backend will be using Node and express, will have access to the
                database (Mongodb in this case), and will expose API endpoints that can take different actions relating
                to the database. The frontend will be using React, is the view of the webpage, and will be what makes
                requests to the backend.
            </p>
            <br /><br />
            <h4 id="section2">2. MERN File Overview</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                A backend and frontend project will need to be setup that will be ran separately.
            </p>
            <h5 id="section2a"><i>2.a Backend</i></h5>
            <ul>
                <li><u>workoutModel.js:</u> This is use to map an object to the database documents for easier use.</li>
                <li><u>workoutController.js:</u> This is where the workout logic will be. It contains functions to get
                    workouts, add a workout, delete a workout, etc. It will also use the workout Model to make the edits
                    to the database.</li>
                <li><u>workoutRoutes.js:</u> This is where the workout endpoints are setup. I define workout URIs that
                    call a specific workout action from the workout Controller.</li>
                <li><u>server.js:</u> This is the main server file that will be ran and listens for requests. Important
                    things like the port number, db connection, route usage are setup here.</li>
            </ul>
            <p class="paragraphText">
                Note: there are also some user related files but that will be discussed more later.
            </p>
            <h5 id="section2b"><i>2.b Frontend</i></h5>
            <p class="paragraphText">
                The bulk of the workout related content will be in the MyWorkouts.js file. It contains things involving
                displaying and adding workouts.
            </p>

            <pre class="codeBlockPanel"><code>
// Example of getting workouts using fetch
//MyWorkouts.js, in useEffect
...
const response = await fetch('/api/workout/workouts', {
    headers:{'Authorization': `Bearer ${user.token}`}
});
...
// Note: authorization fields in header is related to how authentication is done. This is discussed more later.
            </code></pre>

            <pre class="codeBlockPanel"><code>
// Example of Adding a workout using fetch
//MyWorkouts.js, in handleSubmit function
...
// workout parameters are stored in react state variable and are set in the form elements.
const workout = { title, reps, sets, weekday, bodyPart};

const response = await fetch('/api/workout/workout', {
    method: 'POST',
    body: JSON.stringify(workout),
    headers: { 
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${user.token}`
    }
})
...
            </code></pre>
            <p class="paragraphText">Something to note is that there will be a cors error when trying to run a fetch
                request from a frontend to a backend of the same locations so I used a proxy to deal with this error.
            </p>
            <pre class="codeBlockPanel"><code>
// Example code to add in package.json to add proxy
// port 4000 is the same as the backend
"proxy": "http://localhost:4000",
            </code></pre>

            <br /><br />
            <h4 id="section3">3. Authentication</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">There is a user model, controller, and route file for actions relating to users. To
                get authentication going I use JSON Web token to verify users. When a user signs-up/logs-in from the
                frontend, a JSON Web token will get created in the backend. This token is then sent to the frontend
                where it gets stored locally. After that, any subsequent request by the frontend that require
                authentication, will also send back the token. This token gets verified and does the action in the
                backend. The next sections will go more in depth on how its done.</p>
            <h5 id="section2a"><i>3.a Password Check (Backend)</i></h5>
            <p class="paragraphText">
                Storing the passwords involve using the "bcrypt" library to hash the password with a generated salt
                value and store it in the database. When the user logs in, the password is compared to the stored hash
                password (with salt) using the "bcrypt" library. To accomplish this I added a static function to the
                user models called 'signup' and 'login.' This is where password related checks are done.
            </p>
            <pre class="codeBlockPanel"><code>
// userModel.js, in "signup" static function
// Example of how the password is stored
const salt = await bcrypt.genSalt(10);
const hash = await bcrypt.hash(password,salt);

const user = await this.create({email, password:hash});
            </code></pre>
            <pre class="codeBlockPanel"><code>
// userModel.js, in "login" static function
// Example of how password is checked
// password is passed into function as paramter, and user.password is retrived from db using the email parameter
const match = await bcrypt.compare(password,user.password);
    if(!match){
        throw Error('Incorrect Password');
    }
            </code></pre>
            <h5 id="section3b"><i>3.b Token Creation (Backend)</i></h5>
            <p class="paragraphText">Token generation is done in the backend User controller. First there is a function
                to create the token:</p>
            <pre class="codeBlockPanel"><code>
// In userController.js
// function to generate jwt.
const jwt = require('jsonwebtoken');
...
const createToken = (_id) => {
    return jwt.sign({_id}, process.env.SECRET, {expiresIn:'1d'});
}
//Note: secret string is stored in a hidden file.
            </code></pre>
            <p class="paragraphText">
                With the above function, Tokens will be generated when the user sign in/logs in.
            </p>
            <pre class="codeBlockPanel"><code>
// In userController.js, in login_user or signup_user function
// Generating token that gets return to user in frontend
const token = createToken(user._id);
            </code></pre>

            <h5 id="section3c"><i>3.c Setting Token (Frontend)</i></h5>
            <p class="paragraphText">In the frontend, I have signup and login page with some form setup. When a form are
                submitted, a signup/login hook will handle the API request to the backend. The backend will then respond
                the a token and email.</p>
            <pre class="codeBlockPanel"><code>
//in useLogin.js hook
// Example of calling API to login 
const response = await fetch('/api/user/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({email,password})
    })
const json = await response.json();
            </code></pre>
            <p class="paragraphText">The token will then be store to local storage (after some other checks.)</p>
            <pre class="codeBlockPanel"><code>
// In useLogin.js hook
// Example of saving response (token and email) to local storage
localStorage.setItem('user', JSON.stringify(json));
            </code></pre>

            <h5 id="section3d"><i>3.d Sending Token (Frontend)</i></h5>
            <p class="paragraphText">With a jwt stored, we can send the token with any subsequent workout related
                requests to the backend. Example of this can be seen in the "MERN File Overview/frontend" section,
                specifically the part involving how a request is made to the backend ( Authorization fields in the
                header). There is also an "AuthContext" file that sets the user data (like the token) when logging in.
                This context is used to have global token access and allow the "MyWorkouts" page to use it.</p>

            <h5 id="section3e"><i>3.e Token Check (Backend)</i></h5>
            <p class="paragraphText">Add Text</p>

            <br /><br />
            <h4 id="section4">4. Final Thoughts</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">Add Text</p>

            <br /><br />
            <h4 id="section5">Resources</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">Add Text</p>

            <hr class="whiteLine" />
            <br />
            <a href="../projects.html">Back to Projects</a>

        </div>
    </div>
    <footer class="footerSection">
        <p>Email: 1hector.ac@gmail.com | <a href="https://github.com/1HectorAC">GitHub Profile</a></p>
    </footer>
</body>

</html>