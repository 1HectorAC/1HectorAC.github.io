<!DOCTYPE html>
<html lang="en">

<head>
    <meta cahrset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../css/default.css">
    <title>Game Manager Blog</title>
</head>

<body>
    <div class="title text-center">
        <h1><a href="../index.html">Programming Portfolio</a></h1>
        <h6><i>By Hector Acosta-Cervantes</i></h6>
    </div>
    <nav class="navbar navbar-expand-sm sticky-top navBarColor">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation"
                style="background-color:white">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../projects.html">Projects</a>
                    </li>
                    <li class="nav-item customNavItem">
                        <a class="nav-link" href="../about.html">About</a>
                    </li>
                </ul>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                    <li><a class="dropdown-item customNavItem" href="../index.html">Home</a></li>
                    <li><a class="dropdown-item customNavItem" href="../projects.html">Projects</a></li>
                    <li><a class="dropdown-item customNavItem" href="../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container text-center">
        <div class="whitePanel">
            <h2><b>Game Manager Blog</b></h2>
            <h4><i>ASP.NET MVC & Chart.js</i></h4>
        </div>
    </div>
    <div class="container">

        <div class="row">
            <div class="col-md-4">
                <div class="blackPanel">
                    <h4>Summary</h4>
                    <hr class="whiteLine" />
                    <p class="paragraphText">
                        This website is about analyzing the users video game purchasing and playing habits. A user can
                        make an account where they can add games to a list. This list is then analyzed on various pages.
                        Link to the git hub
                        repositiory <a href="https://github.com/1HectorAC/GameManager">here.</a>
                    </p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="blackPanel">
                    <h4>Goal</h4>
                    <hr class="whiteLine" />
                    <p class="paragraphText">The goal was to get more practice with ASP.NET MVC Framework and to use
                        chart.js.
                    </p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="blackPanel">
                    <h4>Tools</h4>
                    <hr class="whiteLine" />
                    <p class="paragraphText">
                        The main language I used was C#. ASP.NET MVC web framework was used and Visual Studio was my
                        IDE. I also use SQL Server with SQL Management Studio. I also use the chart.js library.
                    </p>
                </div>
            </div>
            <div class="col-md-6 offset-md-3">
                <div class="blackPanel">
                    <h4>Table of Contents</h4>
                    <hr class="whiteLine" />
                    <ol>
                        <li><a href="#introSection">Intro</a></li>
                        <li><a href="#databaseSection">Database</a></li>
                        <li><a href="#setupSection">About Setup</a></li>
                        <li><a href="#moneyAnalysis">Money Analysis</a>
                            <ul>
                                <li><a href="#moneyAnalysisPart1">GET Version</a>
                                <li><a href="#moneyAnalysisPart2">BuyData ViewModel</a>
                                <li><a href="#moneyAnalysisPart3">Post Version</a>
                                <li><a href="#moneyAnalysisPart4">Charts</a>
                                <li><a href="#moneyAnalysisPart5">View</a>
                            </ul>
                        </li>
                    </ol>
                    <li><a href="#finalSection">Final Thoughts</a></li>
                </div>
            </div>
        </div>
        <div class="blackPanelWithMorePadding">
            <h4 id="introSection">1. Intro</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                I will start off by mentioning that a lot of the setup around using ASP.NET MVC Framework will be
                skipped over given
                that I have already covered that enough in my cs460 homework. The main feature I will cover is the Money
                Analysis page which displays various information of games bought like totals games, total spent, how
                much spend per month, and etc. Some of the information will also be shown in charts using the charts.js
                library. There are also other pages that analyze games but the basic layout is similar enough to Money
                Analysis that I found no need to cover them.
            </p>
            <br /><br />
            <h4 id="databaseSection">2. Database</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                There are 3 main tables in the database with some other auto generated account tables. There is the
                "GameUsers" table to manage the user, the "Games" table store data relating to a game, and a
                "GameSystems" table to store the system options that a game can be from.
            </p>
            <div class="row">
                <div class="col-md-6">
                    <p class="paragraphText">
                        The "GameUsers" and "GameSystem" are simple enough were they don’t need an explanation. I should
                        mention
                        that the "GameSystem" table is populated by the "up" script and is not edited by the user. The
                        "Games"
                        table is the biggest table given that it has to track various factors that will be analyzed. I
                        will note
                        that Game bought and Games played can be analyzed in different pages which is why they have
                        different
                        date fields. Also game replayed or borrowed wouldn’t be bought which is why some purchase
                        related fields
                        can be null. I have provided a simple diagram of the database tables. There is also a more
                        detailed setup in the "App_Data/up.sql" file.
                    </p>
                </div>
                <div class="col-md-6">
                    <img class="formatedImage" src="images/GameManagerDBDiagram.PNG" alt="">
                </div>
            </div>


            <br /><br />
            <h4 id="setupSection">3. About Setup</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                While I won't go too into the setup I wanted to quickly mention a few things that are important to at
                least know about. First, it has account management. This can be setup when making a project in Visual
                Studio. I also used ASP.NET MVC scaffolding to make the CRUD page for managing Games.
            </p>
            <br /><br />
            <h4 id="moneyAnalysis">4. Money Analysis</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                The money analysis page will first require the user select a year to analyze from a dropdown (Note that
                if the user bought no games then no year will be shown.) After that it will show information about
                bought game in the form of listed totals and charts. In the GamesController there are two function that
                return an actionResult involving MoneyAnalysis. One is the GET and the other is a POST version.
            </p>
            <br /><br />
            <h5 id="moneyAnalysisPart1"><i>4.a GET Version</i></h5>
            <p class="paragraphText">
                The GET version of MoneyAnalysis is when the page is initially visited. It will setup a dropdown to
                select a year to analyze. After a year is submitted then the POST version gets called. Below is an
                Example of the GET version. The only notable part is the Linq query to get a list of years based on the
                users games.
            </p>
            <pre class="codeBlockPanel"><code>
// GET Version of MoneyAnalysis in Controllers/GamesController.cs
[Authorize]
    public ActionResult MoneyAnalysis()
    {
        var gamesList = GetUserGamesList(User.Identity.GetUserId());
        var yearsList = gamesList
                .Where(g =&gt; g.DateOfPurchase != null)
                .Select(g =&gt; g.DateOfPurchase.Value.Year).Distinct();

        if (yearsList.Count() &gt;= 1)
            ViewBag.SelectYear = new SelectList(yearsList);

        return View();
    }
            </code></pre>
            <br /><br />
            <h5 id="moneyAnalysisPart2"><i>4.b BuyData ViewModel</i></h5>
            <p class="paragraphText">
                Before I get to the POST version of the MoneyAnalysis I need to cover how the data is setup. This is
                done with a View Model that contains all the information relating to the analysis. It contains various
                total counts, monthly counts, and game system totals. There is an array for price range counts with its
                label. Example of the ViewModel called BuyData is shown below:
            </p>
            <pre class="codeBlockPanel"><code>
// Models/ViewModels/BuyData.cs
public class BuyData
    {
        public int TotalSpent { get; set; }
        public int TotalGames { get; set; }
        public int AverageSpend { get; set; }
        public int TotalPhysical { get; set; }
        public int TotalDigital { get; set; }
        public int[] MonthlyTotalSpent { get; set; }
        public int[] MonthlyTotalGames { get; set; }
        public int[] MonthlyTotalPhysical { get; set; }
        public int[] MonthlyTotalDigital { get; set; }
        public int[] TotalByPriceRange { get; set; }
        public string[] SystemNames { get; set; }
        public int[] SystemCounts { get; set; }

        public string[] Months { get; set; } = new string[] {
            "January", "Feburary", "March", "April", "May", "June", "July",
            "August", "September", "October", "November", "December"
        };

        public string[] PriceLabels = new string[] {
            "&lt;$20", "$20-$29", "$30-$39", "$40-$49", "$50-$59",
            "$60-$69", "$70-$79", "$80-$89", "$90-$99", ">$100"
        };
    }
            </code></pre>
            <br /><br />
            <h5 id="moneyAnalysisPart3"><i>4.c Post Version</i></h5>
            <p class="paragraphText">
                The POST Version of the MoneyAnalysis largely involved setting up data and return a view with it. The
                function starts by initialize any variables that will be needed in setting up the BuyData ViewModel.
            </p>
            <pre class="codeBlockPanel"><code>
// POST Version of MoneyAnalysis in Controllers/GamesController.cs
    var gamesList = GetUserGamesList(User.Identity.GetUserId());
    var gamesListOfYear = gamesList
            .Where(g =&gt; g.DateOfPurchase != null && g.Price != null && g.DateOfPurchase.Value.Year == SelectYear)
            .OrderByDescending(g =&gt; g.DateOfPurchase);

    // Make variables for buyData fields.
    var totalSpent = (int)gamesListOfYear.Sum(g =&gt; g.Price);
    var totalGames = gamesListOfYear.Count();
    var systemInfo = gamesListOfYear.GroupBy(c =&gt; c.SystemName);
    int[] monthlyCost = new int[12];
    int[] monthlyCount = new int[12];
    int[] monthlyPhysicalCount = new int[12];
    int[] monthlyDigitalCount = new int[12];
    int[] priceRange = new int[10];
    int index = 0;
            </code></pre>
            <p class="paragraphText">
                The monthly related arrays (and price range) are then setup using a foreach loop to go through every
                game. At first I tried to do this with a Linq Query but I had trouble accounting for months with no
                games not being counted.
            </p>
            <pre class="codeBlockPanel"><code>
// POST Version of MoneyAnalysis in Controllers/GamesController.cs
foreach (Game g in gamesListOfYear.ToList())
{
    // Increment cost and count.
    monthlyCost[g.DateOfPurchase.Value.Month - 1] += (int)g.Price;
    monthlyCount[g.DateOfPurchase.Value.Month - 1] += 1;

    // Increment montlyPhysicalCount or monthlyDigitalCount.
    if (g.Physical)
        monthlyPhysicalCount[g.DateOfPurchase.Value.Month - 1] += 1;
    else
        monthlyDigitalCount[g.DateOfPurchase.Value.Month - 1] += 1;

    // Increment for price range.
    decimal gameCost = g.Price.Value;
    if (gameCost &lt; 20)
        priceRange[0]++;
    else if (gameCost &gt;= 100)
        priceRange[9]++;
    else
        priceRange[(int)Math.Floor(gameCost / 10) - 1]++;
    index++;
}
            </code></pre>
            <p class="paragraphText">
                BuyData is then created using the variables that were setup before.
            </p>
            <pre class="codeBlockPanel"><code>
// POST Version of MoneyAnalysis in Controllers/GamesController.cs
BuyData buyData = new BuyData
{
    TotalSpent = totalSpent,
    TotalGames = totalGames,
    AverageSpend = (int)Math.Round((decimal)(totalSpent / totalGames)),
    TotalPhysical = gamesListOfYear.Where(g =&gt; g.Physical == true).Count(),
    TotalDigital = gamesListOfYear.Where(g =&gt; g.Physical == false).Count(),
    MonthlyTotalSpent = monthlyCost,
    MonthlyTotalGames = monthlyCount,
    MonthlyTotalPhysical = monthlyPhysicalCount,
    MonthlyTotalDigital = monthlyDigitalCount,
    TotalByPriceRange = priceRange,
    SystemNames = systemInfo.Select(c =&gt; c.Key).ToArray(),
    SystemCounts = systemInfo.Select(c =&gt; c.Count()).ToArray()
};
…
return View(buyData);
            </code></pre>
            <br /><br />
            <h5 id="moneyAnalysisPart4"><i>4.d Charts</i></h5>
            <div class="row">
                <div class="col-md-5">
                    <p class="paragraphText">
                        Before I cover the MoneyAnalysis view section I wanted to go over some chart functions. The
                        function for the bar graph is shown. The most notable parts would be the parameters. The
                        "canvasId" is used to identify the html element where the chart will be added, "GraphTitle" is
                        the title that will display, "xValues" is the data (money), and "yValues" is the labels
                        (months).
                    </p>
                </div>
                <div class="col-md-7">
                    <pre class="codeBlockPanel"><code>
// Scripts/GraphSetup.js
﻿function BarGraphSetup(canvasId, graphTitle, xValues, yValues) {
    var g1 = '#38ef7d';
    var g2 = '#11998e';
    var g3 = '#05665b';
    var color1 = [g1, g2, g1, g2, g1, g2, g1, g2, g1, g2, g1, g2];
    var color2 = [g3, g3, g3, g3, g3, g3, g3, g3, g3, g3, g3, g3];

    new Chart(canvasId, {
        type: "bar",
        data: {
            labels: xValues,
            datasets: [{
                backgroundColor: color1,
                data: yValues,
                borderColor: color2,
                borderWidth: 2
            }]
        },
        options: {
            legend: { display: false },
            title: {
                display: true,
                text: graphTitle,
                fontSize: 25
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
}
                    </code></pre>
                </div>
                <div class="col-md-5">
                    <p class="paragraphText">
                        Below is the setup for the pie chart.I should note that the "type" is used to make it a pie
                        chart instead of a bar graph like the previous one.
                    </p>
                </div>
                <div class="col-md-7">
                    <pre class="codeBlockPanel"><code>
// Scripts/GraphSetup.js
function PieGraphSetup(canvasId, graphTitle, xValues, yValues) {
    var g3 = '#05665b';
    var color1 = [
        '#38ef7d', '#18AD94', '#12E8DD', '#2E96E6', '#315AA6',
        '#656EE6', '#7DE843', '#6ADB00', '#63C757', '#59A6CF'
        ];
    var color2 = [g3, g3, g3, g3, g3, g3, g3, g3, g3, g3, g3, g3,];

    new Chart(canvasId, {
        type: "pie",
        data: {
            labels: xValues,
            datasets: [{
                backgroundColor: color1,
                data: yValues,
                borderColor: color2
            }]
        },
        options: {
            title: {
                display: true,
                text: graphTitle,
                fontSize: 25
            },
        }
    });
}
                    </code></pre>
                </div>
            </div>
            <br /><br />
            <h5 id="moneyAnalysisPart5"><i>4.e View</i></h5>
            <div class="row">
                <div class="col-md-6">
                    <p class="paragraphText">
                        One of the first things in the view is the model that gets passed into it. The code shows this.
                    </p>
                </div>
                <div class="col-md-6">
                    <pre class="codeBlockPanel"><code>
// Views/Games/MoneyAnalysis.cshtml
@model GameManager.Models.ViewModels.BuyData
                    </code></pre>
                </div>
                <div class="col-md-6">
                    <p class="paragraphText">
                        This code shows a quick example on how to access the data from the BuyData ViewModel that was
                        setup before.
                    </p>
                </div>
                <div class="col-md-6">
                    <pre class="codeBlockPanel"><code>
// Views/Games/MoneyAnalysis.cshtml
&lt;h1&gt;@Model.TotalSpent&lt;/h1&gt;
                    </code></pre>
                </div>
            </div>
            <p class="paragraphText">
                The chart.js cdn is needed at the top of the page to access the library. Example shown below:
            </p>
            <pre class="codeBlockPanel"><code>
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw==" crossorigin="anonymous"&gt;&lt;/script&gt;
            </code></pre>
            <p class="paragraphText">
                The canvas element is then needed in the view to know where the chart will be placed. Example of this
                shown below. Note that the id will be used specify which canvas element to add a chart to.
            </p>
            <pre class="codeBlockPanel"><code>
// Views/Games/MoneyAnalysis.cshtml
&lt;canvas id="costBarGraph" width="700" height="275"&gt;&lt;/canvas&gt;
&lt;canvas id="consolePie" height="350" style="width:100%;max-width:600px;"&gt;&lt;/canvas&gt;
            </code></pre>
            <p class="paragraphText">
                In the final part of the charts, the data is setup and passed to the function to make the charts.
                Something to note is how the data from the model was converted to Javascript in the process. This was
                accomplished by encoding it to Json and then reading the raw html of it. Example shown below:
            </p>
            <pre class="codeBlockPanel"><code>
// Views/Games/MoneyAnalysis.cshtml
&lt;script src="@Url.Content("~/Scripts/GraphSetup.js")" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;
    //Setup monthly cost(costData) for chart.
    var costData = @Html.Raw(Json.Encode(Model.MonthlyTotalSpent));

    //Setup system name and data for chart.
    var systemData = @Html.Raw(Json.Encode(Model.SystemCounts));
    var systemNames = @Html.Raw(Json.Encode(Model.SystemNames));

    var monthsLabel = ['Jan', 'Feb', 'March', 'April', 'May', 'June', 'July', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    BarGraphSetup("costBarGraph", "Money Spent by Month($)", monthsLabel, costData);
    PieGraphSetup("consolePie", "Games Bought by Console", systemNames, systemData);
&lt;/script&gt;
            </code></pre>
            <br /><br />
            <h4 id="finalSection">5. Final Thoughts</h4>
            <hr class="whiteLine" />
            <p class="paragraphText">
                The easiest part for me was the ASP.NET MVC web Framework features due to my familiarity with it. One
                thing that took me a bit more time was the tables setup in the database. I find that creating a database
                isn't hard but creating an efficient/organized one required more thought. To create a good database
                requires a good understanding of how the data is going to be used and that means a lot more pre-planning
                of the project. The chart related features were new to me but was a lot easier to setup than I expected.
                The <a href="https://www.chartjs.org/">chartjs.org</a> website provides easy to follow examples that
                helped.
            </p>
        </div>
    </div>
</body>

</html>